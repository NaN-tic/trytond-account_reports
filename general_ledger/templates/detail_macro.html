{% macro cell(value='', cls='', style='', colspan=1, format='pdf') %}
  <td
    {% if cls %}class="{{ cls }}"{% endif %}
    {% if style %}style="{{ style }}"{% endif %}
    {% if colspan != 1 %}colspan="{{ colspan }}"{% endif %}
  >{{ value }}</td>
  {% if format == 'xlsx' and colspan|int > 1 %}
    {% for _ in range(colspan - 1) %}
      <td></td>
    {% endfor %}
  {% endif %}
{% endmacro %}

<table>
  <tr>
    <th>{{ _('Date') }}</th>
    <th>{{ _('Number') }}</th>
    <th>{{ _('Reference') }} // {{ _('Description') }}</th>
    <th style="text-align: right;">{{ _('Debit') }}</th>
    <th style="text-align: right;">{{ _('Credit') }}</th>
    <th style="text-align: right;">{{ _('Balance') }}</th>
  </tr>
  {% for k, record in records.items() %}
    <tr>
      {{ cell(value=record.code, cls='bold', colspan=2, format=format) }}
      {{ cell(value=record.party or record.account, cls='bold', format=format) }}
      {{ cell(value=_('Previous balance...') if record.lines else '', style='text-align: right;', colspan=2, format=format) }}
      {{ cell(value=record.previous_balance|render if record.lines else '', style='text-align: right;', format=format) }}
    </tr>

    {{ show_detail_lines(record) }}

    <tr class="bold">
      {{ cell(value=_('Total Fiscal Year'), style='text-align: right;', colspan=3, format=format) }}
      {{ cell(value=record.total_debit|render, style='text-align: right;', cls='no-wrap', format=format) }}
      {{ cell(value=record.total_credit|render, style='text-align: right;', cls='no-wrap', format=format) }}
      {{ cell(value=(record.total_debit - record.total_credit)|render, style='text-align: right;', cls='no-wrap', format=format) }}
    </tr>

    <tr class="bold bottom">
      {{ cell(value=record.code, cls='bold', colspan=2, format=format) }}
      {{ cell(value=(record.party if record.party else record.account), cls='bold', format=format) }}
      {{ cell(value=_('Total'), cls='left bold', colspan=2, format=format) }}
      {{ cell(value=(record.previous_balance + record.total_debit - record.total_credit)|render, style='text-align: right;', cls='no-wrap', format=format) }}
    </tr>
  {% endfor %}
</table>
