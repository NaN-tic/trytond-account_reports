{% macro cell(value='', cls='', style='', colspan=1, format='pdf') %}
  <td
    {% if cls %}class="{{ cls }}"{% endif %}
    {% if style %}style="{{ style }}"{% endif %}
    {% if colspan != 1 %}colspan="{{ colspan }}"{% endif %}
  >{{ value }}</td>
  {% if format == 'xlsx' and colspan|int > 1 %}
    {% for _ in range(colspan - 1) %}
      <td></td>
    {% endfor %}
  {% endif %}
{% endmacro %}

{%- set p = data['parameters'] -%}
{% for k, record in data['records'].items() %}
    <table>
        <thead>
        <tr>
            <th>{{ _('Move Date')}}</th>
            <th>{{ _('Account')}}</th>
            <th></th>
            <th>{{ _('NIF')}}</th>
            <th>{{ _('Invoice')}}</th>
            <th>{{ _('Date')}}</th>
            <th style="text-align: right;">{{ _('Base')}}</th>
            <th></th>
            <th style="text-align: right;">{{ _('Tax')}}</th>
            <th style="text-align: right;">{{ _('Base + Tax')}}</th>
            <th style="text-align: right;">{{ _('Total Invoice')}}</th>
        </tr>
        </thead>
        <tr>
          <td colspan="11" style="text-align: left !important;padding-left: 35px !important;" class="bold">{% if k[2] %}{{ k[2] }} ({{ (k[0] * 100)|round(0) }}%){% else %}{{ k[0].name }}{% endif %}</td>
        </tr>
        {% set currency_digits = k[1].currency.digits %}
        {% if not p['totals_only'] %}
            {{ show_detail_lines(record) }}
        {% endif %}
        {% if p['tax_totals'].get(k) %}<tr class="bold">
            {{ cell(value=_('Total Period') if p['jump_page'] else _('Total'), style='text-align: right;', colspan=6, format=format) }}
            <td style="text-align: right;">{{p['tax_totals'][k]['total_untaxed'] | render(digits=currency_digits)}}</td>
            <td></td>
            <td style="text-align: right;">{{p['tax_totals'][k]['total_tax'] | render(digits=currency_digits)}}</td>
            <td style="text-align: right;">{{p['tax_totals'][k]['total'] | render(digits=currency_digits)}}</td>
            <td></td>
        </tr>{% endif %}
        {% if p['jump_page'] %}
            {% if loop.nextitem is not defined %}
                <tr class="bold">
                    {{ cell(value=_('Total'), style='text-align: right;', colspan=6, format=format) }}
                    <td style="text-align: right;">{{ p['totals']['total_untaxed'] | render(digits=currency_digits)}}</td>
                    <td></td>
                    <td style="text-align: right;">{{ p['totals']['total_tax'] | render(digits=currency_digits)}}</td>
                    <td style="text-align: right;">{{ p['totals']['total'] | render(digits=currency_digits)}}</td>
                    <td></td>
                </tr>
            {% endif %}
        {% endif %}
    </table>
    {%if p['jump_page'] %}
        {% if loop.nextitem is defined %}
            <p style="page-break-before: always" ></p>
        {% endif %}
    {% endif %}
{% endfor %}
